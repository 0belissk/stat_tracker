#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup script, version 3.2.0
# ----------------------------------------------------------------------------

if [ -z "$MAVEN_SKIP_RC" ] ; then

  if [ -f /usr/local/etc/mavenrc ] ; then
    . /usr/local/etc/mavenrc
  fi

  if [ -f "$HOME/.mavenrc" ] ; then
    . "$HOME/.mavenrc"
  fi

fi

cygwin=false
mingw=false
case "`uname`" in
  CYGWIN*) cygwin=true ;;
  MINGW*) mingw=true ;;
  MSYS*) mingw=true ;;
  NONSTOP*) nonstop=true ;;
  *) ;;
esac

if [ -z "$JAVA_HOME" ] ; then
  if [ -x "/usr/libexec/java_home" ] ; then
    JAVA_HOME="`/usr/libexec/java_home`"
  fi
fi

if [ -z "$JAVA_HOME" ] ; then
  javaExecutable="`which java`"
  if [ -n "$javaExecutable" ] && ! [ "`expr \"$javaExecutable\" : '\([^ ]*\)'`" = "no" ] ; then
    JAVA_HOME="`dirname \"$javaExecutable\"`/.."
  fi
fi

if [ -z "$JAVA_HOME" ] ; then
  echo "Error: JAVA_HOME is not defined correctly." >&2
  echo "  We cannot execute java" >&2
  exit 1
fi

JAVA_CMD="$JAVA_HOME/bin/java"
if [ ! -x "$JAVA_CMD" ] ; then
  echo "Error: JAVA_HOME is not defined correctly." >&2
  echo "  We cannot execute $JAVA_CMD" >&2
  exit 1
fi

BASE_DIR="`dirname "$0"`"
MAVEN_PROJECTBASEDIR="`cd "$BASE_DIR" ; pwd`"

WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain

WRAPPER_JAR="$MAVEN_PROJECTBASEDIR/.mvn/wrapper/maven-wrapper.jar"
if [ ! -f "$WRAPPER_JAR" ]; then
  if [ "$MVNW_VERBOSE" = true ]; then
    echo "Couldn't find $WRAPPER_JAR, downloading it ..."
  fi
  DOWNLOAD_URL="https://repo.maven.apache.org/maven2/org/apache/maven/wrapper/maven-wrapper/3.2.0/maven-wrapper-3.2.0.jar"
  DOWNLOAD_SUCCESS=false
  if command -v curl > /dev/null 2>&1; then
    if curl -fsSL "$DOWNLOAD_URL" -o "$WRAPPER_JAR"; then
      DOWNLOAD_SUCCESS=true
    fi
  elif command -v wget > /dev/null 2>&1; then
    if wget -q "$DOWNLOAD_URL" -O "$WRAPPER_JAR"; then
      DOWNLOAD_SUCCESS=true
    fi
  else
    echo "Error: Please install curl or wget to download the Maven Wrapper." >&2
  fi

  if [ "$DOWNLOAD_SUCCESS" != true ]; then
    if command -v mvn > /dev/null 2>&1; then
      if [ "$MVNW_VERBOSE" = true ]; then
        echo "Falling back to system Maven (mvn) because the wrapper JAR could not be downloaded." >&2
      fi
      exec mvn -f "$MAVEN_PROJECTBASEDIR/pom.xml" -Dmaven.multiModuleProjectDirectory="$MAVEN_PROJECTBASEDIR" "$@"
    fi
    echo "Error: Failed to download $WRAPPER_JAR and no system Maven (mvn) command is available." >&2
    exit 1
  fi
fi

if [ "$cygwin" = true ] || [ "$mingw" = true ] ; then
  [ -n "$JAVA_HOME" ] &&
    JAVA_HOME="`cygpath --path --windows "$JAVA_HOME"`"
  [ -n "$CLASSPATH" ] &&
    CLASSPATH="`cygpath --path --windows "$CLASSPATH"`"
  [ -n "$MAVEN_PROJECTBASEDIR" ] &&
    MAVEN_PROJECTBASEDIR="`cygpath --path --windows "$MAVEN_PROJECTBASEDIR"`"
fi

WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain

exec "$JAVA_CMD" \
  -classpath "$WRAPPER_JAR" \
  -Dmaven.multiModuleProjectDirectory="$MAVEN_PROJECTBASEDIR" \
  $WRAPPER_LAUNCHER "$@"
